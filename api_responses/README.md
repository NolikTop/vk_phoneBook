# Описание методов API

Виды ответов:

+ [Успешный ответ](#успешный-ответ)
+ [Ответ с ошибкой](#ответ-с-ошибкой)

[Вызов методов API](#вызов-методов-api)

Методы API:

+ [phone.getCountry](#phonegetcountry)
+ [phone.search](#phonesearch)
+ [phone.getReviews](#phonegetreviews)
+ [phone.addReview](#phoneaddreview)
+ [phone.rateReview](#phoneratereview)

[Ошибки при вызове методов API](#ошибки-при-вызове-методов-api)

---

## Виды ответов

### Успешный ответ

```json5
{
  "response": {} // данные, может быть вообще любой тип
}
```

---

### Ответ с ошибкой

Если ошибка возникла при валидации значения параметра:
```json5
{
  "error": {
    "code": 100, // код ошибки, число
    "message": "Unauthorized", // сообщение об ошибке, строка
    "parameter": "access_token" // параметр, при валидации которого вылезла ошибка
  }
}
```

В иных случаях:
```json5
{
  "error": {
    "code": 100, // код ошибки, число
    "message": "Unauthorized", // сообщение об ошибке, строка
  }
}
```

---

## Вызов методов API

Передавать данные можно используя либо _GET_, либо _POST_ http метод.

Все аргументы, после которых стоит * (звездочка), являются обязательными.

Рекомендую использовать POST, так как при GET плюсик (+) превращается в пробел.

---

## Методы API

### phone.getCountry

#### Входные параметры

| параметр | тип    | пример значения | описание       |
|----------|--------|-----------------|----------------|
| phone*   | string | +79111234567    | номер телефона |

#### Пример ответа

```json
{
  "response": {
    "country": "RU"
  }
}
```

---

### phone.search

#### Входные параметры

| параметр | тип    | пример значения | описание       |
|----------|--------|-----------------|----------------|
| phone*   | string | +79111234567    | номер телефона |

#### Пример ответа

```json
{
  "response": [
    {
      "number": "+79111231234",
      "reviews_count": 100
    },
    {
      "number": "+79111231234",
      "reviews_count": 100
    },
  ]
}
```

---

### phone.getReviews

#### Входные параметры

| параметр | тип          | пример значения | значение по умолчанию | описание                    |
|----------|--------------|-----------------|-----------------------|-----------------------------|
| phone*   | string       | +79111234567    |                       | номер телефона              |
| offset   | unsigned int | 3               | 10                    | сдвиг для пагинации         |
| count    | unsigned int | 3               | 10                    | кол-во возвращаемых отзывов |

#### Пример ответа

```json
{
  "response": {
    "all_count": 100,
    "reviews": [
      {
        "id": 10,
        "rating": 20,
        "author": "анонимно",
        "review": "spam",
        "created_at": 1648738789
      },
      {
        "id": 9,
        "rating": -3,
        "author": "Андрей",
        "review": "нехороший человек",
        "created_at": 1648738789
      }
    ]
  }
}
```

---

### phone.addReview

#### Входные параметры

| параметр     | тип    | пример значения | описание           |
|--------------|--------|-----------------|--------------------|
| phone*       | string | +79111234567    | номер телефона     |
| review*      | string | spam            | текст отзыва       |
| access_token | string |                 | токен пользователя |

Если был передан токен пользователя, то отзыв будет создан от его имени.
Если токен не был передан, то отзыв создан анонимно. 

#### Пример ответа

```json
{
  "response": {
    "review_id": 10
  }
}
```

---

### phone.rateReview

#### Входные параметры

| параметр      | тип          | пример значения | описание                             |
|---------------|--------------|-----------------|--------------------------------------|
| review_id*    | unsigned int | spam            | текст отзыва                         |
| mark*         | 1 или -1     | 1               | повысить или понизить рейтинг отзыва |
| access_token* | string       |                 | токен пользователя                   |

#### Пример ответа

```json
{
  "response": {
    "new_rating": 20
  }
}
```

---

## Ошибки при вызове методов API

| код | описание                                 | возможная причина                                         |
|-----|------------------------------------------|-----------------------------------------------------------|
| 0   | Внутренняя ошибка                        | Указанный метод не найден                                 |
| 1   | Неверно переданный тип                   | поле принимает int, а вы передали string (например "abc") |
| 2   | Недействительный токен                   | переданный токен никому не принадлежит                    |
| 3   | Не указано значение параметра            | Не передано значение обязательного параметра              |
| 4   | Слишком длинное значение                 | Передана слишком длинная строка                           |
| 5   | Передано отрицательное или нецелое число | Аргумент принимает только целые неотрицательные числа     |
| 6   | Контроллер с таким именем не найден      | Указанный контроллер не найден                            |
| 7   | Метод с таким именем не найден           | Указанный метод не найден                                 |
| 8   | Номер телефона не найден                 | Указанный номер телефона не найден                        |
| 9   | Неизвестный регион номера                | Указанный номер телефона не найден                        |
| 20  | Указанный отзыв удален или не существует | Переданный id отзыв'а не существует                       |